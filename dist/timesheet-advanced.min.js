!function(){"use strict";function merge(target,source){"object"!=typeof target&&(target={});for(var property in source)if(source.hasOwnProperty(property)){var sourceProperty=source[property];if("object"==typeof sourceProperty){target[property]=merge(target[property],sourceProperty);continue}target[property]=sourceProperty}for(var a=2,l=arguments.length;l>a;a++)merge(target,arguments[a]);return target}var Timesheet=function(data,options){this.options=this.mergeWithDefault(options),this.data=[],this.bubbles=[],this.widthYear=0,this.parse(data||[]),"undefined"!=typeof document&&(this.container="string"==typeof this.options.container?document.querySelector("#"+this.options.container):this.options.container,this.drawSections(),this.drawCurrentMonth(),this.insertData())};Timesheet.prototype.mergeWithDefault=function(options){var defaults={container:"timesheet",type:"parallel",theme:"dark",extraClass:"",showDate:!0,timesheetYearMin:null,timesheetYearMax:null,scrollX:!0,bubbleMonthMargin:1};return merge(defaults,options)},Timesheet.prototype.parse=function(data){for(var overrideTimesheetMin=null===this.options.timesheetYearMin,overrideTimesheetMax=null===this.options.timesheetYearMax,n=0;n<data.length;n++){var bubbleStart=checkValue(data[n].start,null),bubbleEnd=checkValue(data[n].end,null),label=checkValue(data[n].label,null),bubbleType=checkValue(data[n].type,"default"),link=checkValue(data[n].link,null),dataAttributes=checkValue(data[n].data,{});if(!bubbleStart)throw"Label start is required for bubble "+(n+1);bubbleStart=this.parseDate(bubbleStart),bubbleEnd&&(bubbleEnd=this.parseDate(bubbleEnd)),overrideTimesheetMin&&bubbleStart.getFullYear()<this.options.timesheetYearMin&&(this.options.timesheetYearMin=bubbleStart.getFullYear()),overrideTimesheetMax&&(bubbleEnd&&bubbleEnd.getFullYear()>this.options.timesheetYearMax?this.options.timesheetYearMax=bubbleEnd.getFullYear():bubbleStart.getFullYear()>this.options.timesheetYearMax&&(this.options.timesheetYearMax=bubbleStart.getFullYear())),this.data.push({start:bubbleStart,end:bubbleEnd,label:label,bubbleType:bubbleType}),this.bubbles.push(this.createBubble({start:bubbleStart,end:bubbleEnd,type:bubbleType,label:label,dataAttributes:dataAttributes,timesheetYearMin:this.options.timesheetYearMin,timesheetYearMax:this.options.timesheetYearMax,link:link,present:!1}))}},Timesheet.prototype.bubbleFits=function(bubbleStart,bubbleEnd){var dateTimesheetStart=new Date("01/01/"+this.options.timesheetYearMin),dateTimesheetEnd=new Date("12/31/"+this.options.timesheetYearMax),fits=!1;return bubbleStart>dateTimesheetStart&&dateTimesheetEnd>bubbleStart&&(fits=!0),dateTimesheetEnd>bubbleStart&&bubbleEnd>dateTimesheetStart&&(fits=!0),fits},Timesheet.prototype.parseDate=function(date){return-1===date.indexOf("/")?(date=new Date(parseInt(date,10),0,1),date.hasMonth=!1):(date=date.split("/"),date=new Date(parseInt(date[1],10),parseInt(date[0],10)-1,1),date.hasMonth=!0),date},Timesheet.prototype.drawSections=function(){for(var html=[],c=this.options.timesheetYearMin;c<=this.options.timesheetYearMax;c++)html.push("<section>"+c+"</section>");this.container.className="timesheet timesheet--"+this.options.type,this.options.theme.length&&(this.container.className+=" timesheet--"+this.options.theme),this.options.extraClass.length&&(this.container.className+=" "+this.options.extraClass),this.container.innerHTML='<div class="tsa-scale">'+html.join("")+"</div>"},Timesheet.prototype.drawCurrentMonth=function(){var date=new Date;if(this.options.timesheetYearMax>=date.getFullYear()&&this.options.timesheetYearMax===date.getFullYear()&&date.getMonth()<12){this.widthYear=this.container.querySelector(".tsa-scale section").offsetWidth;var currentMonthOffset=12*(this.options.timesheetYearMax-this.options.timesheetYearMin)+date.getMonth();this.container.innerHTML+='<div class="tsa-vertical-line" style="left: '+currentMonthOffset*(this.widthYear/12)+'px;"></div>'}},Timesheet.prototype.insertData=function(){"parallel"===this.options.type?this.generateMarkupParallel():"serial"===this.options.type&&this.generateMarkupSerial();var bubbleFilter=function(elem){return hasClass(elem,"tsa-bubble")};this.container.addEventListener?(this.container.addEventListener("click",delegate(bubbleFilter,drawTooltip,this.options.theme)),this.options.scrollX&&(this.container.addEventListener("mousewheel",timesheetScrollbar,!1),this.container.addEventListener("DOMMouseScroll",timesheetScrollbar,!1))):(this.container.attachEvent("click",delegate(bubbleFilter,drawTooltip,this.options.theme)),this.options.scrollX&&this.container.attachEvent("onmousewheel",timesheetScrollbar))};var delegate=function(criteria,listener,theme){return function(e){var el=e.target;do if(criteria(el))return e.delegateTarget=el,e.theme=theme,void listener.apply(this,arguments);while(el=el.parentNode)}},hasClass=function(element,cls){return(" "+element.className+" ").indexOf(" "+cls+" ")>-1},timesheetScrollbar=function(e){e=window.event||e;var delta=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));this.scrollLeft-=40*delta,this.scrollLeft>0&&this.scrollWidth-this.scrollLeft!==this.offsetWidth&&e.preventDefault()};Timesheet.prototype.generateMarkupParallel=function(){var html=[];this.widthYear=this.container.querySelector(".tsa-scale section").offsetWidth;for(var startTag="",endTag="",n=0;n<this.bubbles.length;n++){var bubble=this.bubbles[n];if(this.bubbleFits(bubble.start,bubble.end)){var bubbleClasses=["tsa-bubble","tsa-bubble-"+bubble.type];bubble.startedBeforeTimesheet&&bubbleClasses.push("tsa-bubble--started-before"),bubble.endedAfterTimesheet&&bubbleClasses.push("tsa-bubble--ended-after");var position=bubble.getPosition(this);bubble.link&&bubble.link.length?(startTag='<a class="tsa-bubble-link" href="'+bubble.link+'" style="margin-left: '+position.offset+'">',endTag="</a>",bubbleClasses.push("tsa-bubble--linked")):(startTag='<span style="margin-left: '+position.offset+'">',endTag="</span>");var dataAttributes="";for(var dataName in bubble.dataAttributes)bubble.dataAttributes.hasOwnProperty(dataName)&&(dataAttributes+=" data-"+dataName+'="'+bubble.dataAttributes[dataName]+'"');var line=['<span data-bubble-link="'+bubble.link+'" data-bubble-label="'+bubble.label+'" data-bubble-date="'+bubble.getDateLabel()+'" style="margin-left: '+position.offset+"; width: "+position.width+';" class="'+bubbleClasses.join(" ")+'" data-duration="'+bubble.monthsLength+'"'+dataAttributes+"></span>"+startTag+'<span class="tsa-date">'+bubble.getDateLabel()+"</span>",'<span class="tsa-label">'+bubble.label+"</span>"+endTag].join("");html.push("<li>"+line+"</li>")}}this.container.innerHTML+='<ul class="tsa-data">'+html.join("")+"</ul>"},Timesheet.prototype.generateMarkupSerial=function(){var i,j,currentList,currentBubble,html=[];this.widthYear=this.container.querySelector(".tsa-scale section").offsetWidth;var lists=this.buildSerialBubbleLists();for(html.push('<ul class="tsa-data">'),i=0;i<lists.length;i++)if(currentList=lists[i],currentList.bubbles.length){html.push("<li>"),html.push('<ul class="tsa-bubbles-wrapper">');var line=[];for(j=0;j<currentList.bubbles.length;j++){currentBubble=currentList.bubbles[j];var position=currentBubble.getPosition(this),bubbleClasses=["tsa-bubble","tsa-bubble-"+currentBubble.type];currentBubble.startedBeforeTimesheet&&bubbleClasses.push("tsa-bubble--started-before"),currentBubble.endedAfterTimesheet&&bubbleClasses.push("tsa-bubble--ended-after"),currentBubble.link&&currentBubble.link.length&&bubbleClasses.push("tsa-bubble--linked"),line.push("<li>",'<span data-bubble-link="'+currentBubble.link+'" data-bubble-label="'+currentBubble.label+'" data-bubble-date="'+currentBubble.getDateLabel()+'" style="left: '+position.offset+"; width: "+position.width+';" class="'+bubbleClasses.join(" ")+'" data-duration="'+currentBubble.monthsLength+'"></span>',"</li>")}html.push(line.join("")),html.push("</ul>"),html.push("</li>")}html.push("</ul>"),this.container.innerHTML+=html.join("")},Timesheet.prototype.buildSerialBubbleLists=function(){var i,j,list,bubble,lists=[{monthOffsetEnd:0,bubbles:[]}];for(i=0;i<this.bubbles.length;i++)if(bubble=this.bubbles[i],this.bubbleFits(bubble.start,bubble.end))for(j=0;j<lists.length;j++){if(list=lists[j],!list.monthOffsetEnd||list.monthOffsetEnd+this.options.bubbleMonthMargin<=bubble.monthOffsetStart){lists[j].bubbles.push(bubble),lists[j].monthOffsetEnd=bubble.monthOffsetEnd;break}if(j===lists.length-1){lists[j+1]={monthOffsetEnd:bubble.monthOffsetEnd,bubbles:[bubble]};break}}return lists},Timesheet.prototype.createBubble=function(options){if(null===options.end){var currentDate=new Date,maxDate=new Date(this.options.timesheetYearMax,12,31);currentDate.getTime()<maxDate.getTime()?options.end=currentDate:options.end=maxDate,options.present=!0}return new Bubble(options)};var drawTooltip=function(e){e.stopPropagation();var readAttributes=function(element){return{dateLabel:element.getAttribute("data-bubble-date"),label:element.getAttribute("data-bubble-label"),link:element.getAttribute("data-bubble-link")}};removeActiveClass(".tsa-bubble");var textLabel,tooltipPositionX,content=readAttributes(e.delegateTarget),tooltip=document.createElement("div"),dateLabel=document.createElement("span"),indicator=document.createElement("div"),dateLabelValue=document.createTextNode(content.dateLabel),labelValue=document.createTextNode(content.label),oldTooltip=document.querySelector("#timesheet-tooltip"),activeBubble=e.target;-1===activeBubble.className.indexOf("active")&&(activeBubble.className+=" active"),tooltip.className="tsa-tooltip","light"===e.theme&&(tooltip.className+=" tsa-tooltip--dark"),tooltip.id="timesheet-tooltip",dateLabel.appendChild(dateLabelValue),dateLabel.className="tsa-tooltip-date",tooltip.appendChild(dateLabel),content.link&&"null"!==content.link&&content.link.length?(textLabel=document.createElement("a"),textLabel.appendChild(labelValue),textLabel.title=content.label,textLabel.href=content.link):(textLabel=document.createElement("p"),textLabel.appendChild(labelValue)),textLabel.className="tsa-tooltip-label",tooltip.appendChild(textLabel),oldTooltip?document.body.replaceChild(tooltip,oldTooltip):document.body.appendChild(tooltip),e.pageX+90>=document.body.clientWidth?(tooltipPositionX=document.body.clientWidth-200,indicator.style.left=Math.min(e.pageX-tooltipPositionX-10,tooltip.offsetWidth-35)+"px"):e.pageX-90<0?(tooltipPositionX=0,indicator.style.left=Math.max(e.pageX-10,15)+"px"):(tooltipPositionX=e.pageX-90,indicator.style.left=tooltip.offsetWidth/2-10+"px"),tooltip.style.left=tooltipPositionX+"px",document.body.clientHeight<e.pageY+tooltip.offsetHeight+7?(tooltip.className+=" tsa-tooltip--top",tooltip.style.top=e.pageY-tooltip.offsetHeight-7+"px",indicator.style.top=tooltip.offsetHeight+"px"):(tooltip.className+=" tsa-tooltip--bottom",tooltip.style.top=e.pageY+7+"px"),indicator.className="tsa-tooltip-indicator",tooltip.appendChild(indicator),document.body.addEventListener?document.body.addEventListener("click",hideTooltips):document.body.attachEvent("click",hideTooltips)},hideTooltips=function(e){var source="undefined"!=typeof e.target?e.target:e.srcElement;if(!source.className||-1===source.className.indexOf("tooltip")){var tooltip=document.querySelector("#timesheet-tooltip");tooltip&&(document.body.removeChild(tooltip),document.body.removeEventListener?document.body.removeEventListener("click",hideTooltips):document.body.detachEvent("click",hideTooltips))}removeActiveClass(".tsa-bubble")},Bubble=function(options){this.start=options.start,this.end=options.end,this.timesheetYearMin=options.timesheetYearMin,this.timesheetYearMax=options.timesheetYearMax,this.startedBeforeTimesheet=!1,this.endedAfterTimesheet=!1;var offsets=this.getMonthOffsets();this.monthOffsetStart=offsets.monthStart,this.monthOffsetEnd=offsets.monthEnd,this.monthsLength=this.monthOffsetEnd-this.monthOffsetStart,this.link=options.link,this.type=options.type,this.label=options.label,this.present=options.present,this.dataAttributes=options.dataAttributes};Bubble.prototype.getMonthOffsets=function(){var offsets={};return offsets.monthStart=Math.abs(12*(this.start.getFullYear()-this.timesheetYearMin)+this.start.getMonth()),offsets.monthEnd=Math.abs(12*(this.end.getFullYear()-this.timesheetYearMin)+this.end.getMonth()),this.start.getFullYear()<this.timesheetYearMin&&(this.startedBeforeTimesheet=!0,offsets.monthStart-=12*(this.timesheetYearMin-this.start.getFullYear())-this.start.getMonth()),this.end.getFullYear()>this.timesheetYearMax&&(this.endedAfterTimesheet=!0,offsets.monthEnd-=12*(this.end.getFullYear()-this.timesheetYearMax-1)+this.end.getMonth()),offsets},Bubble.prototype.formatMonth=function(num){return num=parseInt(num,10),num>=10?num:"0"+num},Bubble.prototype.getWidth=function(widthYear){return widthYear/12*this.monthsLength},Bubble.prototype.getPosition=function(timesheet){var position={};return position.offset=this.monthOffsetStart*timesheet.widthYear/12+"px",position.width=this.getWidth(timesheet.widthYear)+"px",position},Bubble.prototype.getDateLabel=function(){return[(this.start.hasMonth?this.formatMonth(this.start.getMonth()+1)+"/":"")+this.start.getFullYear(),this.present?" - present":" - "+((this.end.hasMonth?this.formatMonth(this.end.getMonth()+1)+"/":"")+this.end.getFullYear())].join("")};var removeActiveClass=function(className){for(var activeElements=document.querySelectorAll(className+".active"),i=0;i<activeElements.length;i++)activeElements[i].className=activeElements[i].className.replace(" active","")},checkValue=function(value,defaultValue){return"object"==typeof defaultValue&&null!==defaultValue?"object"==typeof value&&null!==defaultValue?value:defaultValue:"undefined"!=typeof value&&value.length?value:defaultValue};window.Timesheet=Timesheet}();