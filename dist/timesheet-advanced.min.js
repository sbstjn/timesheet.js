!function(){"use strict";function merge(target,source){"object"!=typeof target&&(target={});for(var property in source)if(source.hasOwnProperty(property)){var sourceProperty=source[property];if("object"==typeof sourceProperty){target[property]=merge(target[property],sourceProperty);continue}target[property]=sourceProperty}for(var a=2,l=arguments.length;l>a;a++)merge(target,arguments[a]);return target}var Timesheet=function(data,options){this.options=this.mergeWithDefault(options),this.data=[],this.bubbles=[],this.widthYear=0,this.parse(data||[]),"undefined"!=typeof document&&(this.container="string"==typeof this.options.container?document.querySelector("#"+this.options.container):this.options.container,this.drawSections(),this.drawCurrentMonth(),this.insertData())};Timesheet.prototype.mergeWithDefault=function(options){var defaults={container:"timesheet",type:"parallel",theme:"dark",extraClass:"",showDate:!0,timesheetYearMin:null,timesheetYearMax:null};return merge(defaults,options)},Timesheet.prototype.parse=function(data){for(var overrideTimesheetMin=null===this.options.timesheetYearMin,overrideTimesheetMax=null===this.options.timesheetYearMax,n=0;n<data.length;n++){if(5!==data[n].length)throw"Not enough input parameters for bubble "+(n+1);var bubbleStart=this.parseDate(data[n][0]),bubbleEnd=""!==data[n][1]?this.parseDate(data[n][1]):null,label=data[n][2],bubbleType=""!==data[n][3]?data[n][3]:"default",link=""!==data[n][4]?data[n][4]:"";overrideTimesheetMin&&bubbleStart.getFullYear()<this.options.timesheetYearMin&&(this.options.timesheetYearMin=bubbleStart.getFullYear()),overrideTimesheetMax&&(bubbleEnd&&bubbleEnd.getFullYear()>this.options.timesheetYearMax?this.options.timesheetYearMax=bubbleEnd.getFullYear():bubbleStart.getFullYear()>this.options.timesheetYearMax&&(this.options.timesheetYearMax=bubbleStart.getFullYear())),this.data.push({start:bubbleStart,end:bubbleEnd,label:label,bubbleType:bubbleType}),this.bubbles.push(this.createBubble({start:bubbleStart,end:bubbleEnd,type:bubbleType,label:label,timesheetYearMin:this.options.timesheetYearMin,timesheetYearMax:this.options.timesheetYearMax,link:link}))}},Timesheet.prototype.bubbleFits=function(bubbleStart,bubbleEnd){var dateTimesheetStart=new Date("01/01/"+this.options.timesheetYearMin),dateTimesheetEnd=new Date("12/31/"+this.options.timesheetYearMax),fits=!1;return bubbleStart>dateTimesheetStart&&dateTimesheetEnd>bubbleStart&&(fits=!0),dateTimesheetEnd>bubbleStart&&bubbleEnd>dateTimesheetStart&&(fits=!0),fits},Timesheet.prototype.parseDate=function(date){return-1===date.indexOf("/")?(date=new Date(parseInt(date,10),0,1),date.hasMonth=!1):(date=date.split("/"),date=new Date(parseInt(date[1],10),parseInt(date[0],10)-1,1),date.hasMonth=!0),date},Timesheet.prototype.drawSections=function(){for(var html=[],c=this.options.timesheetYearMin;c<=this.options.timesheetYearMax;c++)html.push("<section>"+c+"</section>");this.container.className="timesheet timesheet--"+this.options.type,this.options.extraClass.length&&(this.container.className+=" "+this.options.extraClass),this.container.innerHTML='<div class="scale">'+html.join("")+"</div>"},Timesheet.prototype.drawCurrentMonth=function(){var date=new Date;if(this.options.timesheetYearMax>=date.getFullYear()&&this.options.timesheetYearMax===date.getFullYear()&&date.getMonth()<12){this.widthYear=this.container.querySelector(".scale section").offsetWidth;var currentMonthOffset=12*(this.options.timesheetYearMax-this.options.timesheetYearMin)+date.getMonth();this.container.innerHTML+='<div class="ts-vertical-line" style="left: '+currentMonthOffset*(this.widthYear/12)+'px;"></div>'}},Timesheet.prototype.insertData=function(){"parallel"===this.options.type?this.generateMarkupParallel():"serial"===this.options.type&&this.generateMarkupSerial();var bubbleFilter=function(elem){return hasClass(elem,"bubble")};this.container.addEventListener("click",delegate(bubbleFilter,drawTooltip))};var delegate=function(criteria,listener){return function(e){var el=e.target;do if(criteria(el))return e.delegateTarget=el,void listener.apply(this,arguments);while(el=el.parentNode)}},hasClass=function(element,cls){return(" "+element.className+" ").indexOf(" "+cls+" ")>-1};Timesheet.prototype.generateMarkupParallel=function(){var html=[];this.widthYear=this.container.querySelector(".scale section").offsetWidth;for(var startTag="",endTag="",n=0;n<this.bubbles.length;n++){var bubble=this.bubbles[n];if(this.bubbleFits(bubble.start,bubble.end)){var position=bubble.getPosition(this);""!==bubble.link?(startTag='<a class="bubble-link" href="'+bubble.link+'" style="margin-left: '+position.offset+'">',endTag="</a>"):(startTag='<span style="margin-left: '+position.offset+'">',endTag="</span>");var bubbleClasses=["bubble","bubble-"+bubble.type];bubble.startedBeforeTimesheet&&bubbleClasses.push("bubble--started-before"),bubble.endedAfterTimesheet&&bubbleClasses.push("bubble--ended-after");var line=['<span data-bubble-link="'+bubble.link+'" data-bubble-label="'+bubble.label+'" data-bubble-date="'+bubble.getDateLabel()+'" style="margin-left: '+position.offset+"; width: "+position.width+';" class="'+bubbleClasses.join(" ")+'" data-duration="'+bubble.monthsLength+'"></span>'+startTag+'<span class="date">'+bubble.getDateLabel()+"</span>",'<span class="label">'+bubble.label+"</span>"+endTag].join("");html.push("<li>"+line+"</li>")}}this.container.innerHTML+='<ul class="data">'+html.join("")+"</ul>"},Timesheet.prototype.generateMarkupSerial=function(){var i,j,currentList,currentBubble,html=[];this.widthYear=this.container.querySelector(".scale section").offsetWidth;var lists=this.buildSerialBubbleLists();for(html.push('<ul class="data">'),i=0;i<lists.length;i++)if(currentList=lists[i],currentList.bubbles.length){html.push("<li>"),html.push('<ul class="ts-bubbles-wrapper">');var line=[];for(j=0;j<currentList.bubbles.length;j++){currentBubble=currentList.bubbles[j];var position=currentBubble.getPosition(this),bubbleClasses=["bubble","bubble-"+currentBubble.type];currentBubble.startedBeforeTimesheet&&bubbleClasses.push("bubble--started-before"),currentBubble.endedAfterTimesheet&&bubbleClasses.push("bubble--ended-after"),line.push("<li>",'<span data-bubble-link="'+currentBubble.link+'" data-bubble-label="'+currentBubble.label+'" data-bubble-date="'+currentBubble.getDateLabel()+'" style="left: '+position.offset+"; width: "+position.width+';" class="'+bubbleClasses.join(" ")+'" data-duration="'+currentBubble.monthsLength+'"></span>',"</li>")}html.push(line.join("")),html.push("</ul>"),html.push("</li>")}html.push("</ul>"),this.container.innerHTML+=html.join("")},Timesheet.prototype.buildSerialBubbleLists=function(){var i,j,list,bubble,lists=[{monthOffsetEnd:0,bubbles:[]}];for(i=0;i<this.bubbles.length;i++)for(bubble=this.bubbles[i],j=0;j<lists.length;j++){if(list=lists[j],!list.monthOffsetEnd||list.monthOffsetEnd+1<=bubble.monthOffsetStart){lists[j].bubbles.push(bubble),lists[j].monthOffsetEnd=bubble.monthOffsetEnd;break}if(j===lists.length-1){lists[j+1]={monthOffsetEnd:bubble.monthOffsetEnd,bubbles:[bubble]};break}}return lists},Timesheet.prototype.createBubble=function(options){if(null===options.end){var currentDate=new Date,maxDate=new Date(this.options.timesheetYearMax,12,31);currentDate.getTime()<maxDate.getTime()?options.end=currentDate:options.end=maxDate,options.present=!0}else options.present=!1;return new Bubble(options)};var drawTooltip=function(e){var textLabel,readAttributes=function(element){return{dateLabel:element.getAttribute("data-bubble-date"),label:element.getAttribute("data-bubble-label"),link:element.getAttribute("data-bubble-link")}},content=readAttributes(e.delegateTarget),tooltip=document.createElement("div"),dateLabel=document.createElement("span"),dateLabelValue=document.createTextNode(content.dateLabel),labelValue=document.createTextNode(content.label);tooltip.className="timesheet-tooltip",tooltip.id="timesheet-tooltip",dateLabel.appendChild(dateLabelValue),dateLabel.className="timesheet-tooltip-date",tooltip.appendChild(dateLabel),content.link?(textLabel=document.createElement("a"),textLabel.appendChild(labelValue),textLabel.title=content.label,textLabel.href=content.link):(textLabel=document.createElement("p"),textLabel.appendChild(labelValue)),textLabel.className="timesheet-tooltip-label",tooltip.appendChild(textLabel),tooltip.style.left=e.pageX+"px",tooltip.style.top=e.pageY+"px",document.body.appendChild(tooltip)},Bubble=function(options){this.start=options.start,this.end=options.end,this.timesheetYearMin=options.timesheetYearMin,this.timesheetYearMax=options.timesheetYearMax,this.startedBeforeTimesheet=!1,this.endedAfterTimesheet=!1;var offsets=this.getMonthOffsets();this.monthOffsetStart=offsets.monthStart,this.monthOffsetEnd=offsets.monthEnd,this.monthsLength=this.monthOffsetEnd-this.monthOffsetStart,this.link=options.link,this.type=options.type,this.label=options.label,this.present=options.present};Bubble.prototype.getMonthOffsets=function(){var offsets={};return offsets.monthStart=Math.abs(12*(this.start.getFullYear()-this.timesheetYearMin)+this.start.getMonth()),offsets.monthEnd=Math.abs(12*(this.end.getFullYear()-this.timesheetYearMin)+this.end.getMonth()),this.start.getFullYear()<this.timesheetYearMin&&(this.startedBeforeTimesheet=!0,offsets.monthStart-=12*(this.timesheetYearMin-this.start.getFullYear())-this.start.getMonth()),this.end.getFullYear()>this.timesheetYearMax&&(this.endedAfterTimesheet=!0,offsets.monthEnd-=12*(this.end.getFullYear()-this.timesheetYearMax-1)+this.end.getMonth()),offsets},Bubble.prototype.formatMonth=function(num){return num=parseInt(num,10),num>=10?num:"0"+num},Bubble.prototype.getWidth=function(widthYear){return widthYear/12*this.monthsLength},Bubble.prototype.getPosition=function(timesheet){var position={};return position.offset=this.monthOffsetStart*timesheet.widthYear/12+"px",position.width=this.getWidth(timesheet.widthYear)+"px",position},Bubble.prototype.getDateLabel=function(){return[(this.start.hasMonth?this.formatMonth(this.start.getMonth()+1)+"/":"")+this.start.getFullYear(),this.present?" - present":" - "+((this.end.hasMonth?this.formatMonth(this.end.getMonth()+1)+"/":"")+this.end.getFullYear())].join("")},window.Timesheet=Timesheet}();